# 完整配置参考：https://github.com/MetaCubeX/mihomo/blob/Meta/docs/config.yaml

# 已知大概率被封的DOT/DOH，需要根据本地ISP自行测试
# ⚠️ 强烈推荐不要写域名形式的DOT/DOH，ISP很可能对所有疑似DOH/DOT做拦截
# DOT/DOH域名被封是因为需要DNS明文查询，将常见DOH/DOT域名不做响应即可
# TLS/HTTPS IP被封的原因是未开启ECH/ESNI，所以会对SNI内容进行查询，知道你访问的哪个IP，会封锁常见的DOT/DOH国外IP
# https://1.1.1.1/dns-query
# https://1.0.0.1/dns-query
# tls://1.1.1.1
# tls://1.0.0.1
# tls://8.8.8.8
dns:
  use-system-hosts: false
  enable: true
  ipv6: true
  use-hosts: true
  respect-rules: false # dns根据rules代理，让代理服务器帮助走nameserver、fallback...
  enhanced-mode: fake-ip
  default-nameserver: # 兜底nameserver域名情况
    # - 1.1.1.1
    - tls://1.12.12.12
    - tls://8.8.4.4
  proxy-server-nameserver: # 由代理服务器查询dns时，查询代理服务器的dns解析（对于某些代理DNS会被ISP更改，最好用tls）
    # 由于运营商会根据tls://域名，其中域名会走default-nameserver，DNS明文查询，这里运营商会拦截所有海外的DOT/DOH，所以这里最好用IP国内即可
    # 推荐：后续的DOT/DOH最好用IP而不是域名，避免被ISP拦截，导致DOH/DOT被污染
    - tls://1.12.12.12
    - tls://120.53.53.53
    - tls://8.8.4.4
  # 优先于nameserver/fallback规则
  nameserver-policy:
    'geosite:openai,google,anthropic': [tls://dns.google]
    'geosite:cn': [119.29.29.29] # 对国内geosite
    'rule-set:icloud,apple,direct,applications': [119.29.29.29]
    'geosite:gfw,greatfire': [tls://dns.google] # 对geosite中的gfw、greatfire
    'rule-set:gfw': [tls://dns.google]
  # 默认DNS
  nameserver:
    - 119.29.29.29
  # 国外DNS
  # fallback: 
  #   - 8.8.8.8
  #   - 1.1.1.1
  # fallback-filter:
  #   geoip: true
  #   geoip-code: CN

# GEO相关内容默认采用 https://github.com/Loyalsoldier开发的
  # https://github.com/Loyalsoldier/v2ray-rules-dat

# 参考：https://github.com/Loyalsoldier/clash-rules?tab=readme-ov-file
rule-providers:
  reject:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt"
    path: ./ruleset/reject.yaml
    interval: 86400

  icloud:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt"
    path: ./ruleset/icloud.yaml
    interval: 86400

  apple:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt"
    path: ./ruleset/apple.yaml
    interval: 86400

  google:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt"
    path: ./ruleset/google.yaml
    interval: 86400

  proxy:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt"
    path: ./ruleset/proxy.yaml
    interval: 86400

  direct:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt"
    path: ./ruleset/direct.yaml
    interval: 86400

  private:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt"
    path: ./ruleset/private.yaml
    interval: 86400

  gfw:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt"
    path: ./ruleset/gfw.yaml
    interval: 86400

  tld-not-cn:
    type: http
    behavior: domain
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt"
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400

  telegramcidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt"
    path: ./ruleset/telegramcidr.yaml
    interval: 86400

  cncidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt"
    path: ./ruleset/cncidr.yaml
    interval: 86400

  lancidr:
    type: http
    behavior: ipcidr
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt"
    path: ./ruleset/lancidr.yaml
    interval: 86400

  applications:
    type: http
    behavior: classical
    url: "https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt"
    path: ./ruleset/applications.yaml
    interval: 86400

  # 自定义的开发直连环境
  dev-direct:
    type: http
    behavior: classical
    url: https://jybill.github.io/mihomo-config-rules/rule-set/dev-direct.yaml
    path: ./ruleset/dev-direct.yaml
    format: yaml
    interval: 86400

  daily-foreign:
    type: http
    behavior: classical
    url: https://jybill.github.io/mihomo-config-rules/rule-set/daily-foreign.yaml
    path: ./ruleset/daily-foreign.yaml
    format: yaml
    interval: 86400